{include="header"}
   <script type="text/javascript">
      let url = "{$gsc->url()}";
   </script>
   <script src="{#JG_PATH#}plugins/pagosycobros/view/js/crear_devolucion_cliente.js"></script>
   <div class='container-fluid'>
      <div class="row">
         <div class="col-sm-6">
            <div class="btn-group">
               <a class="btn btn-sm btn-secondary" href="index.php?page=devoluciones_clientes">
                  <span class="bi bi-arrow-left"></span>
                  <span class="d-none d-sm-block">&nbsp; Devoluciones</span>
               </a>
               <a class="btn btn-sm btn-dark" href="{$gsc->url()}" title="recargar la página">
                  <span class="bi bi-bootstrap-reboot"></span>
               </a>
               {if="$gsc->page->is_default()"}
                  <a class="btn btn-sm btn-outline-info" href="{$gsc->url()}&amp;default_page=FALSE" title="Desmarcar como página de inicio.">
                     <i class="bi bi-house-fill" aria-hidden="true"></i>
                  </a>
               {else}
                  <a class="btn btn-sm btn-outline-info" href="{$gsc->url()}&amp;default_page=TRUE" title="Marcar como página de inicio.">
                     <i class="bi bi-house" aria-hidden="true"></i>
                  </a>
               {/if}
            </div>
         </div>
      </div>
      <div class="row"><br></div>
      <div class="row"><hr></div>
      <div class="row"><br></div>
      <div class="row">
         <form name="f_selec_cliente" id="f_selec_cliente" action="{$gsc->url()}" method="post" class="form" role="form">
            <input type="hidden" name="buscar_resultados">
            <div class="card p-1 p-sm-2 shadow rounded-0 overflow-hidden">
               <div class="card-header">
                  <h4>
                     <i class="bi bi-cash-coin" aria-hidden="true"></i>
                     Nueva Devolución a Cliente
                  </h4>
               </div>
               <div class="card-body">
                  <div class="row">
                     <div class="col-sm-4">
                        <label for="idcliente" class="col-form-label">Cliente:</label>
                        <select id="idcliente" name="idcliente" class="form-select" required onchange="this.form.submit()">
                           {if="$gsc->nom_cliente != ''"}
                              <option value="{$gsc->idcliente}">{$gsc->nom_cliente}</option>
                           {/if}
                        </select>
                        <p>Dejar en Blanco para seleccionar de Varios Clientes</p>
                     </div>
                  </div>
               </div>
            </div>
         </form>
      </div>
      <div class="row">
         <form name="f_nueva_devolucion" id="f_nueva_devolucion" action="{$gsc->url()}" method="post" class="form" role="form">
            <input type="hidden" name="gen_devolucion">
            <input type="hidden" name="clienteselect" value="{$gsc->idcliente}">
            <div class="card p-1 p-sm-2 shadow rounded-0 overflow-hidden">
               <div class="card-body">
                  <div class="row">
                     <div class="table-responsive">
                        <table class="table table-hover saldos">
                           <thead>
                              <tr>
                                 <th class="text-center">Identificacion</th>
                                 <th class="text-center">Razon Social</th>
                                 <th class="text-center">Nro. Documento</th>
                                 <th></th>
                                 <th class="text-center">Fecha Transacción</th>
                                 <th class="text-center">Saldo a Favor</th>
                                 <th></th>
                                 <th>
                                    <div class="form-check form-switch" title="Marcar Todos">
                                       <input class="form-check-input" type="checkbox" id="mtodos" onclick="marcar_todos()">
                                    </div>
                                 </th>
                                 <th class="text-center">Valor a Devolver</th>
                                 <th class="text-center">Valor Pendiente</th>
                                 <th></th>
                              </tr>
                           </thead>
                           <tbody>
                              <!--{$x=0}-->
                              {loop="$gsc->resultados"}
                                 <!--{$x+=$value.valor}-->
                                 <tr>
                                    <td class="text-end">
                                       {$value.identificacion}
                                    </td>
                                    <td class="text-end">
                                       {$value.razonsocial}
                                    </td>
                                    <td class="text-end">
                                       {$value.numero_documento}
                                    </td>
                                    <td class="text-left">
                                       <span class="badge bg-info">{$value.documento}</span>
                                    </td>
                                    <td class="text-end">{function="show_fecha($value.fecha_trans)"}</td>
                                    <td class="text-end" id="saldop_{$value.iddocumento}">{function="show_numero2($value.valor)"}</td>
                                    <td class="text-left">$</td>
                                    <td>
                                       <div class="form-check form-switch">
                                          <input class="form-check-input documentospen" type="checkbox" id="marcar_{$value.iddocumento}" name="iddocumentos[]" onclick="activar_saldo('{$value.iddocumento}')" value="{$value.iddocumento}">
                                       </div>
                                    </td>
                                    <td>
                                       <input type="text" class="form-control form-control-sm solo_precios text-end" onclick="this.select()" onchange="calcular_total()" disabled name="valor_{$value.iddocumento}" value="0.00" id="valor_{$value.iddocumento}">
                                    </td>
                                    <td class="text-end" id="saldof_{$value.iddocumento}">{function="show_numero2($value.valor)"}</td>
                                    <td class="text-left">$</td>
                                 </tr>
                              {else}
                                 <tr class="table-warning">
                                    <td colspan="11">Sin Resultados.!</td>
                                 </tr>
                              {/loop}
                           </tbody>
                           <tfoot>
                              <input type="hidden" id="total_anticipos" value="{$x}">
                              <tr>
                                 <td colspan="5"></td>
                                 <td>
                                    <button type="button" class="form-control btn btn-primary">
                                       <span class="d-none d-sm-block">&nbsp; Saldo a Favor</span>
                                       <span id="saldo_a_favor">{function="show_numero2($x)"}</span>
                                       <span>$</span>
                                    </button>
                                 </td>
                                 <td></td>
                                 <td>
                                    <div class="form-check form-switch" title="Marcar Todos">
                                       <input class="form-check-input" type="checkbox" id="mtodos2" onclick="marcar_todos2()">
                                    </div>
                                 </td>
                                 <td>
                                    <button type="button" class="form-control btn btn-success">
                                       <span class="d-none d-sm-block">&nbsp; Total Devolución</span>
                                       <span id="total_devolucion">0.00</span>
                                       <span>$</span>
                                    </button>
                                 </td>
                                 <td>
                                    <button type="button" class="form-control btn btn-info">
                                       <span class="d-none d-sm-block">&nbsp; Valor Pendiente</span>
                                       <span id="saldo_final">{function="show_numero2($x)"}</span>
                                       <span>$</span>
                                    </button>
                                 </td>
                                 <td></td>
                              </tr>
                           </tfoot>
                        </table>
                     </div>
                  </div>
                  <div class="row" id="div_forma_pago" style="display: none;">
                     <div class="col-sm-4">
                        <div class="form-group">
                           <label for="fpselec" class="col-form-label">Forma de Pago:</label>
                           <select class="form-select form-select-sm" id="fpselec" name="fpselec" onchange="buscar_fp()" required>
                              <option value="" selected>Seleccione</option>
                              {loop="$gsc->formaspago->allCobros($gsc->idempresa)"}
                                 <option value="{$value->idformapago}">{$value->nombre}</option>
                              {/loop}
                           </select>
                        </div>
                     </div>
                     <div class="col-sm-4">
                        <div class="form-group">
                           <label for="fec_trans" class="col-form-label">Fecha de Transacción:</label>
                           <input class="form-control form-control-sm" type="date" id="fec_trans" name="fec_trans" required value="{$gsc->today()}">
                        </div>
                     </div>
                     <div class="col-sm-4">
                        <div class="form-group">
                           <label for="num_doc" class="col-form-label">Número de Documento:</label>
                           <input class="form-control form-control-sm solo_numeros text-end" disabled type="text" id="num_doc" required name="num_doc" value="">
                        </div>
                     </div>
                     <div class="col-sm-12">
                        <div class="form-group">
                           <label for="observaciones" class="col-form-label">Observaciones:</label>
                           <textarea class="form-control form-control-sm" id="observaciones" name="observaciones" placeholder="Observaciones" maxlength="300"></textarea>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="card-footer" style="text-align: right;">
                  <button class="btn btn-primary" id="btn_save_devolucion" disabled type="submit">
                     <span class="bi bi-save"></span>
                     <span class="d-none d-sm-block">&nbsp;Generar</span>
                  </button>
               </div>
            </div>
         </form>
      </div>
   </div>
{include="footer"}